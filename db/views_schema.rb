# This is an automatically generated file by rake:db:views:dump_schema
require 'views_schema'
ViewsSchema.create_view(
  'heron_activities_view',
  %Q{select ifnull(`supplier_name_fact`.`object`,`well_supplier_name_fact`.`object`) AS `Supplier sample name`,`input_asset`.`barcode` AS `Input barcode`,`output_asset`.`barcode` AS `Output barcode`,`activity_types`.`name` AS `Activity type`,`instruments`.`name` AS `Instrument`,`kits`.`barcode` AS `Kit barcode`,`kit_types`.`name` AS `Kit type`,`ac`.`completed_at` AS `Date`,`users`.`fullname` AS `User`,`ac`.`id` AS `_activity_id_` from (((((((((((`activities` `ac` left join `asset_groups_assets` `aga` on((`aga`.`asset_group_id` = `ac`.`asset_group_id`))) left join `assets` `output_asset` on((`output_asset`.`id` = `aga`.`asset_id`))) left join `activity_types` on((`ac`.`activity_type_id` = `activity_types`.`id`))) left join `kits` on((`ac`.`kit_id` = `kits`.`id`))) left join `kit_types` on((`kits`.`kit_type_id` = `kit_types`.`id`))) left join `instruments` on((`ac`.`instrument_id` = `instruments`.`id`))) left join `facts` `supplier_name_fact` on(((`supplier_name_fact`.`asset_id` = `output_asset`.`id`) and (`supplier_name_fact`.`predicate` = 'supplier_sample_name')))) left join `facts` `well_fact` on(((`well_fact`.`asset_id` = `output_asset`.`id`) and (`well_fact`.`predicate` = 'contains')))) left join `facts` `well_supplier_name_fact` on(((`well_supplier_name_fact`.`asset_id` = `well_fact`.`object_asset_id`) and (`well_supplier_name_fact`.`predicate` = 'supplier_sample_name')))) left join `assets` `input_asset` on((`input_asset`.`id` = (select `operations`.`object_asset_id` from (`operations` join `steps` on((`steps`.`id` = `operations`.`step_id`))) where ((`operations`.`predicate` = 'transferredFrom') and (`steps`.`activity_id` = `ac`.`id`) and (`operations`.`object_asset_id` is not null)) order by `operations`.`created_at`,`operations`.`id` limit 1)))) left join `users` on((`users`.`id` = (select `steps`.`user_id` from `steps` where ((`steps`.`activity_id` = `ac`.`id`) and (`steps`.`user_id` is not null)) order by `steps`.`created_at`,`steps`.`id` desc limit 1)))) where ((`ac`.`state` = 'finish') and ((`supplier_name_fact`.`id` is not null) or (`well_supplier_name_fact`.`id` is not null)) and (`activity_types`.`name` in ('CGAP Heron Extraction 500ul - 16ul','CGAP Heron Extraction 500ul - 24ul','Illumina Extraction','DNAP Heron Extraction 500ul - 24ul','CGAP Heron Extraction 200ul - 24ul','Heron R&D Extraction')))},
  algorithm: 'UNDEFINED', security: 'DEFINER'
)
